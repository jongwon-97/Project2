<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <link rel="stylesheet" href="/css/event/eventList.css">
  <title>Dev 이벤트 목록</title>
</head>
<body>

<h1>Dev 이벤트 목록</h1>
<form method="get" action="/dev/board/eventList" id="searchForm" class="search-form">
  <input type="text" name="findKeyword" placeholder="제목을 입력하세요"
         th:value="${findKeyword != null ? findKeyword : ''}" class="search-input">
  <button type="submit" class="search-btn">검색</button>
</form>
<table>
  <thead>
  <tr>
    <th>이벤트 제목</th>
    <th>설명</th>
    <th>제한 인원</th>
    <th>참가비</th>
    <th>시작 날짜</th>
    <th>종료 날짜</th>
    <th>상태</th>
    <th>D-DAY</th>
    <th>수정</th>
    <th>삭제</th>
  </tr>
  </thead>
  <tbody>
  <tr th:if="${seasonList.size() == 0}">
    <td colspan="10">등록된 이벤트가 없습니다</td>
  </tr>
  <tr th:each="season : ${seasonList}">
    <td>
      <div class="event-thumbnail">
        <img th:src="${season.seasonThumbnail != null ? season.seasonThumbnail : '/thumbnails/noImage.jpg'}"
             alt="썸네일" />
      </div>

      <a th:href="@{/dev/board/event/detail/{seasonId}(seasonId=${season.seasonId})}"
         th:text="${season.seasonTitle} + ' (' + ${season.roundNumber} + '회차)'"></a>

    </td>
    <td th:text="${season.seasonInfo != null ? season.seasonInfo : '정보 없음'}"></td>
    <td th:text="${season.seasonLimit}"></td>
    <td th:text="${season.seasonFee != null ? season.seasonFee : '무료'}"></td>
    <td th:text="${season.seasonStartDate}"></td>
    <td th:text="${season.seasonEndDate}" class="season-end-date"></td>
    <td th:text="${season.seasonState}"></td>
    <td class="d-day"></td>
    <td>
      <form th:action="@{/dev/board/editEvent/{seasonId}(seasonId=${season.seasonId})}" method="get">
        <button type="submit" class="btn edit-btn">수정</button>
      </form>

    </td>
    <td>
      <form th:action="@{/dev/board/deleteEvent/{seasonId}(seasonId=${season.seasonId})}" method="post">
        <button type="submit" class="btn delete-btn">삭제</button>
      </form>
    </td>
  </tr>
  </tbody>
</table>
<button type="button" onclick="window.location.href='/dev/home'"> home </button>
<button type="button" onclick="window.location.href='/dev/board/event'"> 작성하기 </button>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      const rows = document.querySelectorAll("tbody tr");

      rows.forEach(row => {
          const endDateCell = row.querySelector(".season-end-date");
          const dDayCell = row.querySelector(".d-day");

          if (endDateCell && dDayCell) {
              const endDateStr = endDateCell.textContent.trim();

              if (endDateStr) {
                  const endDate = new Date(endDateStr);
                  const today = new Date();

                  const diffTime = endDate - today;
                  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                  // Update D-DAY
                  if (diffDays > 0) {
                      dDayCell.textContent = `D-${diffDays}`;
                  } else {
                      dDayCell.textContent = "D-0";
                  }
              } else {
                  dDayCell.textContent = "D-알 수 없음";
              }
          }
      });

      // Confirm delete action
      const deleteButtons = document.querySelectorAll(".delete-btn");
      deleteButtons.forEach(button => {
          button.addEventListener("click", event => {
              const confirmed = confirm("정말로 삭제하시겠습니까?");
              if (!confirmed) {
                  event.preventDefault();
              }
          });
      });
  });
</script>
</body>
</html>
