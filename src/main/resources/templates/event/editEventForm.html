<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이벤트 수정</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
        }
        input, textarea, button, img {
            width: 100%;
            margin-top: 5px;
        }
        img {
            max-width: 150px;
            margin-bottom: 10px;
        }
        .form-actions {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>이벤트 수정</h2>
    <form th:action="@{/dev/board/updateEvent}" method="post" enctype="multipart/form-data">
        <!-- 시즌 ID -->
        <input type="hidden" name="seasonId" th:value="${season.seasonId}">

        <!-- 시즌 제목 -->
        <div class="form-group">
            <label for="seasonTitle">제목</label>
            <input type="text" id="seasonTitle" name="seasonTitle" th:value="${season.seasonTitle}" required>
        </div>

        <!-- 시즌 설명 -->
        <div class="form-group">
            <label for="seasonInfo">설명</label>
            <textarea id="seasonInfo" name="seasonInfo" required th:text="${season.seasonInfo}"></textarea>
        </div>

        <!-- 모집 제한 인원 -->
        <div class="form-group">
            <label for="seasonLimit">모집 인원</label>
            <input type="number" id="seasonLimit" name="seasonLimit" th:value="${season.seasonLimit}" required>
        </div>

        <!-- 참가비 -->
        <div class="form-group">
            <label for="seasonFee">참가비</label>
            <input type="number" id="seasonFee" name="seasonFee" th:value="${season.seasonFee}" required>
        </div>

        <!-- 모집 기간 -->
        <div class="form-group">
            <label for="seasonStartDate">모집 시작일</label>
            <input type="date" id="seasonStartDate" name="seasonStartDate" th:value="${season.seasonStartDate}" required>
            <label for="seasonEndDate">모집 종료일</label>
            <input type="date" id="seasonEndDate" name="seasonEndDate" th:value="${season.seasonEndDate}" required>
        </div>

        <!-- 대표 이미지 -->
        <div class="form-group">
            <label for="thumbnail">대표 이미지</label>
            <input type="file" id="thumbnail" name="thumbnail" accept="image/*">
            <div th:if="${season.seasonThumbnail}">
                <p>현재 이미지:</p>
                <img th:src="@{${season.seasonThumbnail}}" alt="썸네일">
            </div>
        </div>

        <!-- 텍스트 추가 및 삭제 -->
            <div class="form-group">
                <label>텍스트 관리</label>
                <div id="text-container">
                    <div th:each="text : ${texts}">
                        <input type="text" name="texts[]" th:value="${text.contentData}" placeholder="텍스트를 입력하세요">
                        <input type="hidden" name="textIds[]" th:value="${text.imgId}">
                        <button type="button" th:onclick="'removeTextField(this, ' + ${text.imgId} + ')'" >삭제</button>
                    </div>
                </div>
                <button type="button" onclick="addTextField()">텍스트 추가</button>
                <input type="hidden" id="deletedTextIds" name="deletedTextIds[]" value="">
            </div>

            <!-- 이미지 관리 -->
            <div class="form-group">
                <label>이미지 관리</label>
                <div id="image-container">
                    <div th:each="image : ${images}">
                        <img th:src="@{${image.imgPath}}" alt="이미지">
                        <input type="hidden" name="existingImageIds[]" th:value="${image.imgId}">
                        <button type="button" th:onclick="'removeImageField(this, ' + ${image.imgId} + ')'" >삭제</button>
                    </div>
                </div>
                <input type="file" name="newImages[]" accept="image/*">
                <input type="hidden" id="deletedImageIds" name="deletedImageIds[]" value="">
            </div>

        <!-- 버튼 -->
        <div class="form-actions">
            <button type="submit">수정</button>
            <a href="/dev/board/eventList">취소</a>
        </div>
    </form>
</div>

<script>
    // 텍스트 필드 추가
    function addTextField() {
        const container = document.getElementById('text-container');
        const newField = document.createElement('div');
        newField.innerHTML = `
            <input type="text" name="texts[]" placeholder="새 텍스트를 입력하세요">
            <button type="button" onclick="removeTextField(this, null)">삭제</button>
        `;
        container.appendChild(newField);
    }

    // 텍스트 필드 삭제
    function removeTextField(button, textId) {
        const deletedTextIds = document.getElementById('deletedTextIds');
        if (textId) {
            // 현재 삭제된 ID 리스트 가져오기
            let currentDeletedIds = JSON.parse(deletedTextIds.value || "[]");
            if (!currentDeletedIds.includes(textId)) {
                currentDeletedIds.push(textId);
            }
            deletedTextIds.value = JSON.stringify(currentDeletedIds); // 업데이트된 삭제 리스트 저장
        }
        button.parentElement.remove(); // 텍스트 필드 삭제
    }

    // 이미지 필드 삭제
    function removeImageField(button, imageId) {
        const deletedImageIds = document.getElementById('deletedImageIds');
        if (imageId) {
            // 현재 삭제된 ID 리스트 가져오기
            let currentDeletedIds = JSON.parse(deletedImageIds.value || "[]");
            if (!currentDeletedIds.includes(imageId)) {
                currentDeletedIds.push(imageId);
            }
            deletedImageIds.value = JSON.stringify(currentDeletedIds); // 업데이트된 삭제 리스트 저장
        }
        button.parentElement.remove(); // 이미지 필드 삭제
    }

</script>
</body>
</html>
