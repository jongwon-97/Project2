<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이벤트 수정</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            margin: 0;
            padding: 20px;
        }
        h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, button, a {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .form-actions {
            display: flex;
            justify-content: space-between;
        }
        img {
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>이벤트 수정</h2>
    <form th:action="@{/dev/board/updateEvent}" method="post" enctype="multipart/form-data">
        <!-- 숨겨진 삭제 ID -->
        <input type="hidden" id="deletedTextIds" name="deletedTextIds">
        <input type="hidden" id="deletedImageIds" name="deletedImageIds">
        <input type="hidden" id="deletedItems" name="deletedItems">
        <!-- 시즌 ID -->
        <input type="hidden" name="seasonId" th:value="${season.seasonId}">
        <!-- 시즌 회차 (roundNumber) -->
        <input type="hidden" name="roundNumber" th:value="${season.roundNumber}">


        <!-- 시즌 제목 -->
        <div class="form-group">
            <label for="title">제목</label>
            <input type="text" id="title" name="seasonTitle" th:value="${season.seasonTitle}" required>
        </div>

        <!-- 시즌 설명 -->
        <div class="form-group">
            <label for="season-info">회차 설명</label>
            <textarea id="season-info" name="seasonInfo" required th:text="${season.seasonInfo}"></textarea>
        </div>

        <!-- 모집 제한 인원 -->
        <div class="form-group">
            <label for="recruitment-count">모집 인원</label>
            <input type="number" id="recruitment-count" name="seasonLimit" th:value="${season.seasonLimit}" required>
        </div>

        <!-- 참가비 -->
        <div class="form-group">
            <label for="fee">지불 비용</label>
            <input type="number" id="fee" name="seasonFee" th:value="${season.seasonFee}" required>
        </div>

        <!-- 모집 기간 -->
        <div class="form-group">
            <label>모집 기간</label>
            <input type="date" id="start-date" name="seasonStartDate" th:value="${season.seasonStartDate}" required> ~
            <input type="date" id="end-date" name="seasonEndDate" th:value="${season.seasonEndDate}" required>
        </div>

        <!-- 대표 이미지 (썸네일) -->
        <div class="form-group">
            <label for="thumbnail">대표 이미지 (썸네일)</label>
            <input type="file" id="thumbnail" name="thumbnail" accept="image/*">
            <p th:if="${season.seasonThumbnail != null}">
                현재 썸네일:
                <img th:src="@{${season.seasonThumbnail}}" alt="썸네일" style="width:100px; height:auto;">
                <input type="hidden" name="existingThumbnail" th:value="${season.seasonThumbnail}">
            </p>
        </div>

        <!-- 텍스트 수정 -->
        <div class="form-group">
            <label for="texts">텍스트 수정 및 추가</label>
            <div id="text-container">
                <div th:each="text : ${texts}">
                    <input type="text" name="texts" th:value="${text.contentData}" placeholder="텍스트를 입력하세요">
                    <input type="hidden" name="textIds" th:value="${text.imgId}">
                    <button type="button" class="btn remove-text-btn" onclick="removeTextField(this)">삭제</button>
                </div>
            </div>
            <button type="button" id="add-text-btn" class="btn add-btn" onclick="addTextField()">텍스트 추가</button>
        </div>

        <!-- 이미지 수정 -->
        <div class="form-group">
            <label>이미지 수정 및 추가</label>
            <div id="image-container">
                <div th:each="image : ${images}">
                    <img th:src="@{${image.imgPath}}" alt="이미지">
                    <input type="hidden" name="existingImageIds" th:value="${image.imgId}">
                    <button type="button" class="btn remove-image-btn" onclick="removeImageField(this)">삭제</button>
                </div>
            </div>
            <label for="new-images">새 이미지 추가</label>
            <div id="new-image-container"></div>
            <button type="button" id="add-image-btn" class="btn add-btn" onclick="addImageField()">이미지 추가</button>
        </div>

        <!-- 수정 및 취소 버튼 -->
        <div class="form-actions">
            <button type="submit">수정</button>
            <a href="/dev/board/eventList">취소</a>
        </div>
    </form>
</div>

<script>
    // 텍스트 필드 추가
    function addTextField() {
        const container = document.getElementById('text-container');
        const newField = document.createElement('div');
        newField.innerHTML = `
            <input type="text" name="texts[]" placeholder="텍스트를 입력하세요">
            <button type="button" class="btn remove-text-btn" onclick="removeTextField(this)">삭제</button>
        `;
        container.appendChild(newField);
    }

// 텍스트 필드 삭제
function removeTextField(button) {
    const deletedItemsInput = document.getElementById('deletedItems');
    const textIdInput = button.previousElementSibling; // 숨겨진 input

    // 삭제할 텍스트 ID 추가
    if (textIdInput && textIdInput.name === "textIds") {
        const deletedItems = deletedItemsInput.value ? JSON.parse(deletedItemsInput.value) : [];
        deletedItems.push({ id: textIdInput.value, type: "text" }); // ID와 content_type 추가
        deletedItemsInput.value = JSON.stringify(deletedItems);
    }

    // 필드 제거
    const container = button.parentElement;
    container.remove();
}

    // 이미지 필드 추가
    function addImageField() {
        const container = document.getElementById('new-image-container');
        const newField = document.createElement('div');
        newField.innerHTML = `
            <input type="file" name="newImages[]" accept="image/*">
            <button type="button" class="btn remove-image-btn" onclick="removeImageField(this)">삭제</button>
        `;
        container.appendChild(newField);
    }

// 이미지 필드 삭제
function removeImageField(button) {
    const deletedItemsInput = document.getElementById('deletedItems');
    const imageIdInput = button.previousElementSibling; // 숨겨진 input

    // 삭제할 이미지 ID 추가
    if (imageIdInput && imageIdInput.name === "existingImageIds") {
        const deletedItems = deletedItemsInput.value ? JSON.parse(deletedItemsInput.value) : [];
        deletedItems.push({ id: imageIdInput.value, type: "image" }); // ID와 content_type 추가
        deletedItemsInput.value = JSON.stringify(deletedItems);
    }

    // 필드 제거
    const container = button.parentElement;
    container.remove();
}


</script>
</body>
</html>
