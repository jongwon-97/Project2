<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>공지사항 수정</title>
    <script>
        function deleteAttachedFile(fileId) {
            if (confirm("첨부파일을 삭제하시겠습니까?")) {
                fetch(`/file/delete?fileId=${fileId}`, { method: 'DELETE' })
                    .then(response => {
                        if (response.ok) {
                            alert("첨부파일이 삭제되었습니다.");
                            location.reload(); // 페이지 새로고침
                        } else {
                            alert("첨부파일 삭제에 실패했습니다.");
                        }
                    })
                    .catch(error => {
                        alert("오류가 발생했습니다: " + error.message);
                    });
            }
        }
    </script>
</head>
<body>
<h1>공지사항 수정</h1>
<form th:action="@{/board/editNotification}" th:method="post" enctype="multipart/form-data">
    <!-- 게시글 ID -->
    <input type="hidden" name="boardId" th:value="${notification.boardId}">

    <!-- 제목 -->
    <div>
        <label for="title">제목:</label>
        <input type="text" id="title" name="boardTitle" th:value="${notification.boardTitle}" required>
    </div>

    <!-- 공지 여부 체크박스 -->
    <div>
        <input type="checkbox" id="isNotice" name="isNotice" value="true"
               th:checked="${notification.isNotice}">
        <label for="isNotice">공지</label>
    </div>

    <!-- 내용 -->
    <div>
        <label for="content">내용:</label>
        <textarea id="content" name="boardContent" required th:text="${notification.boardContent}"></textarea>
    </div>

    <!-- 첨부파일 -->
    <div>
        <p><strong>첨부파일:</strong></p>
        <ul>
            <li th:each="file : ${attachedFiles}">
                <span th:text="${file.fileOriginName}"></span>
                <button type="button" th:onclick="|deleteAttachedFile(${file.fileId})|">삭제</button>
            </li>
        </ul>
        <p th:if="${#lists.isEmpty(attachedFiles)}">첨부된 파일이 없습니다.</p>
    </div>

    <!-- 새로운 파일 첨부 -->
    <div>
        <label for="newFiles">새 파일 첨부:</label>
        <input type="file" id="newFiles" name="newFiles" multiple>
    </div>

    <!-- 버튼 -->
    <div>
        <button type="submit">수정하기</button>
        <a th:href="@{/board/notificationList}">취소</a>
    </div>
</form>
</body>
</html>
